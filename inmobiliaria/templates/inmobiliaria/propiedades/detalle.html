{% extends 'inmobiliaria/base.html' %}
{% load bootstrap4 %}
{% load custom_filters %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card">
                <div class="card-header">
                    <h2 class="text-center">{{ propiedad.direccion }}</h2>
                </div>
                
                <!-- Pestañas de navegación -->
                <ul class="nav nav-tabs" id="propertyTabs" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link" id="alquiler-tab" data-toggle="tab" href="#alquiler" role="tab">
                            <i class="fas fa-calendar-day"></i> Alquiler por Día
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" id="venta-tab" data-toggle="tab" href="#venta" role="tab">
                            <i class="fas fa-money-bill"></i> Venta
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="meses-tab" data-toggle="tab" href="#meses" role="tab">
                            <i class="fas fa-calendar-alt"></i> 24 Meses
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="invierno-tab" data-toggle="tab" href="#invierno" role="tab">
                            <i class="fas fa-snowflake"></i> Invierno
                        </a>
                    </li>
                </ul>

                <div class="tab-content" id="propertyTabContent">
                    <div class="tab-pane fade" id="alquiler" role="tabpanel">
                        <!-- Contenido de alquiler -->
                    </div>

                    <div class="tab-pane fade show active" id="venta" role="tabpanel">
                        <div class="container mt-4">
                            {% if not propiedad.info_venta or not propiedad.info_venta.en_venta %}
                                <div class="text-center">
                                    <div class="alert alert-info p-4">
                                        <i class="fas fa-home fa-3x mb-3 d-block"></i>
                                        <h4>¿Quieres activar la venta de esta propiedad?</h4>
                                        <p>Al activar la venta, podrás establecer el precio y demás detalles necesarios.</p>
                                        <button type="button" class="btn btn-primary btn-lg mt-3" data-bs-toggle="modal" data-bs-target="#modalVenta">
                                            <i class="fas fa-check-circle"></i> Sí, activar venta
                                        </button>
                                    </div>
                                </div>
                            {% else %}
                                <div class="card">
                                    <div class="card-header bg-primary text-white">
                                        <h4 class="mb-0">Información de Venta</h4>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <p><strong>Precio de venta:</strong> ${{ propiedad.info_venta.precio_venta|format_price }}</p>
                                                <p><strong>Precio de autorización:</strong> ${{ propiedad.info_venta.precio_autorizacion|format_price }}</p>
                                                <p><strong>Estado:</strong> {{ propiedad.info_venta.get_estado_display }}</p>
                                            </div>
                                            <div class="col-md-6">
                                                {% if propiedad.info_venta.precio_expensas %}
                                                    <p><strong>Expensas:</strong> ${{ propiedad.info_venta.precio_expensas|format_price }}</p>
                                                {% endif %}
                                                {% if propiedad.info_venta.escribania %}
                                                    <p><strong>Escribanía:</strong> {{ propiedad.info_venta.escribania }}</p>
                                                {% endif %}
                                            </div>
                                        </div>
                                        {% if propiedad.info_venta.observaciones %}
                                            <div class="mt-3">
                                                <strong>Observaciones:</strong>
                                                <p>{{ propiedad.info_venta.observaciones }}</p>
                                            </div>
                                        {% endif %}
                                        <div class="text-center mt-4">
                                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalVenta">
                                                <i class="fas fa-edit"></i> Editar información
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="tab-pane fade" id="meses" role="tabpanel">
                        <!-- Contenido de 24 meses -->
                    </div>

                    <div class="tab-pane fade" id="invierno" role="tabpanel">
                        <!-- Contenido de invierno -->
                    </div>
                </div>

                <!-- Modal de Venta -->
                <div class="modal fade" id="modalVenta" tabindex="-1" aria-labelledby="modalVentaLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <form method="post" action="{% url 'inmobiliaria:editar_info_venta' propiedad_id=propiedad.id %}">
                                {% csrf_token %}
                                <div class="modal-header">
                                    <h5 class="modal-title" id="modalVentaLabel">
                                        {% if propiedad.info_venta and propiedad.info_venta.en_venta %}
                                            Editar información de venta
                                        {% else %}
                                            Activar venta de propiedad
                                        {% endif %}
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" name="en_venta" id="en_venta" 
                                               {% if propiedad.info_venta.en_venta %}checked{% endif %}>
                                        <label class="form-check-label" for="en_venta">
                                            Habilitar venta de propiedad
                                        </label>
                                    </div>
                                    
                                    <div id="info-venta-fields">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="precio_venta" class="form-label">Precio de venta *</label>
                                                <input type="number" class="form-control" id="precio_venta" name="precio_venta" 
                                                       value="{{ propiedad.info_venta.precio_venta|default:'' }}">
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="precio_autorizacion" class="form-label">Precio de autorización *</label>
                                                <input type="number" class="form-control" id="precio_autorizacion" name="precio_autorizacion"
                                                       value="{{ propiedad.info_venta.precio_autorizacion|default:'' }}">
                                            </div>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label for="estado" class="form-label">Estado *</label>
                                                <select class="form-select" id="estado" name="estado">
                                                    <option value="disponible">Disponible</option>
                                                    <option value="reservado">Reservado</option>
                                                    <option value="vendido">Vendido</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="precio_expensas" class="form-label">Precio de expensas</label>
                                                <input type="number" class="form-control" id="precio_expensas" name="precio_expensas"
                                                       value="{{ propiedad.info_venta.precio_expensas|default:'' }}">
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="escribania" class="form-label">Escribanía</label>
                                            <textarea class="form-control" id="escribania" name="escribania" rows="2">{{ propiedad.info_venta.escribania|default:'' }}</textarea>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="observaciones" class="form-label">Observaciones</label>
                                            <textarea class="form-control" id="observaciones" name="observaciones" rows="3">{{ propiedad.info_venta.observaciones|default:'' }}</textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                    <button type="submit" class="btn btn-primary">Guardar cambios</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}